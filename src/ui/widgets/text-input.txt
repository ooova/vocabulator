#ifndef UI_WIDGETS_TEXT_INPUT_H
#define UI_WIDGETS_TEXT_INPUT_H

#include "raylib-cpp.hpp"
#include <string>

namespace ui::widgets {

class TextInput : public RRectangle {
public:
    TextInput(RVector2 position, RVector2 size, RFont&& font,
              RColor text_color = RColor::Black(), RColor background_color = RColor::White(),
              RColor cursor_color = RColor::Black());

    void update(float dt);

    void draw();

    std::string getText() const { return text_; }
    void setText(const std::string& text) { text_ = text; cursor_pos_ = text.size(); }

private:
    std::string text_;
    size_t cursor_pos_ = 0;
    float text_offset_x_;
    bool cursor_visible_ = true;
    float cursor_timer_ = 0.0f;
    RFont font_;
    float font_size_ = 16.0f;
    float spacing_ = 1.0f;
    RColor text_color_;
    RColor background_color_;
    RColor cursor_color_;

    size_t prev_char_pos(size_t pos) const;
    size_t next_char_pos(size_t pos) const;
    std::string codepoint_to_utf8(int codepoint) const;
};

}  // namespace ui::widgets

#endif  // UI_WIDGETS_TEXT_INPUT_H